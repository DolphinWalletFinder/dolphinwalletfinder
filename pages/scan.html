<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan Wallets - Dolphin Finder</title>
  <link rel="stylesheet" href="../assets/style-neon.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(ellipse at center, #000010, #000);
      font-family: 'Orbitron', sans-serif;
      color: #0ff;
      overflow: hidden;
    }

    .container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 2;
      position: relative;
      padding: 20px;
    }

    h1 {
      font-size: 2em;
      color: #0ff;
      margin-bottom: 15px;
      animation: fadeInDown 1s ease-out;
    }

    #typingText {
      font-size: 1.2em;
      color: #aaf;
      margin-bottom: 30px;
      min-height: 60px;
      white-space: pre-wrap;
      animation: fadeIn 2s ease-in;
    }

    .glass-card {
      background: rgba(0, 30, 60, 0.3);
      border: 1px solid rgba(0, 255, 255, 0.2);
      box-shadow: 0 8px 30px rgba(0, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      padding: 40px 30px;
      border-radius: 20px;
      max-width: 600px;
      width: 100%;
      animation: zoomIn 1s ease-out;
    }

    .scan-btn {
      margin-top: 20px;
      padding: 14px 36px;
      font-size: 1.1em;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: #000;
      background: linear-gradient(135deg, #0ff, #08f);
      box-shadow: 0 0 12px #0ff;
      animation: pulseGlow 2s infinite ease-in-out;
      transition: all 0.3s ease;
    }

    .scan-btn:hover {
      background: linear-gradient(135deg, #09f, #0ff);
      box-shadow: 0 0 25px #0ff;
      transform: scale(1.05);
    }

    .radar {
      position: absolute;
      border-radius: 50%;
      display: none;
      z-index: 2;
      background: radial-gradient(circle, rgba(0,255,255,0.05) 0%, transparent 70%);
      box-shadow: 0 0 80px rgba(0,255,255,0.4), inset 0 0 30px rgba(0,255,255,0.3);
      backdrop-filter: blur(4px);
      overflow: hidden;
    }

    .radar::before {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      border: 3px solid rgba(0, 255, 255, 0.2);
      border-radius: 50%;
      animation: pulse 2s infinite ease-in-out;
    }

    .radar::after {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      background: conic-gradient(from 0deg, #0ff6 0deg, #0000 90deg);
      animation: rotate 1.2s linear infinite;
    }

    .control-btns {
      position: absolute;
      bottom: 20px;
      display: none;
      gap: 15px;
      z-index: 5;
    }

    .control-btn {
      padding: 10px 18px;
      background: #0ff;
      color: #000;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: bold;
    }

    @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.05); opacity: 1; } }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 12px #0ff; } 50% { box-shadow: 0 0 25px #0ff; } }

    canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      filter: blur(1px);
    }
  </style>
</head>
<body>
<canvas id="matrixCanvas"></canvas>
<div class="container" id="mainUI">
  <div class="glass-card">
    <h1>Welcome, <span id="username">User</span> üëã</h1>
    <div id="typingText"></div>
    <button class="scan-btn" onclick="startScan()" id="scanBtn">üöÄ Start Scan</button>
  </div>
</div>
<div class="radar" id="radar"></div>
<div class="control-btns" id="controlBtns">
  <button class="control-btn" onclick="pauseScan()">‚è∏ Pause</button>
  <button class="control-btn" onclick="resumeScan()" style="display:none;">‚ñ∂ Resume</button>
</div>

<script>
  const API_BASE = "https://dolphinwalletfinderbackend-production.up.railway.app/api";
  const token = sessionStorage.getItem("token");
  if (!token) window.location.href = "login.html";

  fetch(API_BASE + "/me", { headers: { Authorization: "Bearer " + token } })
    .then(res => res.json())
    .then(data => { document.getElementById("username").textContent = data.username || "User"; });

  const text = "You are now inside Dolphin Wallet Finder. Ready to uncover forgotten crypto wallets?";
  let idx = 0;
  function typeWriter() {
    if (idx < text.length) {
      document.getElementById("typingText").innerHTML += text.charAt(idx);
      idx++;
      setTimeout(typeWriter, 35);
    }
  }
  window.addEventListener("load", typeWriter);

  let scanTimeout, paused = false;

  function startScan() {
    document.getElementById("mainUI").style.display = "none";
    document.getElementById("radar").style.display = "block";
    document.getElementById("controlBtns").style.display = "flex";
    resumeMatrix();
    const delay = Math.floor(Math.random() * (10000 - 3000 + 1)) + 3000;
    scanTimeout = setTimeout(() => {
      const wallet = simulateScan(); // assumes simulateScan is loaded from external wallets.js
      fetch(API_BASE + "/wallets", {
        method: "POST",
        headers: { "Authorization": "Bearer " + token, "Content-Type": "application/json" },
        body: JSON.stringify(wallet)
      })
      .then(() => window.location.href = "results.html");
    }, delay);
  }

  function pauseScan() {
    clearTimeout(scanTimeout);
    paused = true;
    pauseMatrix();
    document.querySelector("#controlBtns button:first-child").style.display = "none";
    document.querySelector("#controlBtns button:last-child").style.display = "inline-block";
  }

  function resumeScan() {
    if (!paused) return;
    paused = false;
    resumeMatrix();
    startScan();
  }

  const canvas = document.getElementById("matrixCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const letters = "0 1 immune flee people initial panic crucial display grace aim copper fashion pelican pulp average wheel pride sketch flag narrow object juice victory swallow refuse goat dune phrase hole boy maid report exhibit ride lecture dynamic burger fork disorder assume table dawn hood office art share later sell paper quick steel acid taste promote robust false hockey employ dinner scene rain".split(" ");
  const fontSize = 14;
  const columns = canvas.width / fontSize;
  const drops = Array(columns).fill(1);
  let matrixInterval;

  function drawMatrix() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#0ff";
    ctx.font = fontSize + "px monospace";
    for (let i = 0; i < drops.length; i++) {
      const text = letters[Math.floor(Math.random() * letters.length)];
      ctx.fillText(text, i * fontSize, drops[i] * fontSize);
      if (drops[i] * fontSize > canvas.height || Math.random() > 0.975) drops[i] = 0;
      drops[i]++;
    }
  }

  function pauseMatrix() {
    clearInterval(matrixInterval);
  }

  function resumeMatrix() {
    matrixInterval = setInterval(drawMatrix, 50);
  }
</script>
<script src="../assets/wallets.js"></script>
</body>
</html>
