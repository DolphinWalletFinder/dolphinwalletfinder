<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Activate License - Dolphin Wallet</title>
  <link rel="stylesheet" href="../assets/style-neon.css" />
  <style>
    body { background: radial-gradient(ellipse at center, #000014, #000); font-family: 'Orbitron', sans-serif; color: #0ff; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
    .license-box { border: 1px solid #0ff4; padding: 40px; border-radius: 18px; background: rgba(0, 10, 20, 0.85); box-shadow: 0 0 25px #0ff4, inset 0 0 20px #0ff3; text-align: center; width: 90%; max-width: 600px; }
    h1 { margin-bottom: 20px; }
    .license-desc { font-size: 0.95em; color: #aff; margin-bottom: 20px; }
    .wallet-address { font-family: monospace; background: #000; padding: 10px; border: 1px dashed #0ff8; border-radius: 8px; margin-bottom: 20px; }
    .copy-btn, .btn { margin-top: 15px; padding: 10px 20px; font-size: 1em; background: #0ff; color: #000; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; }
    .copy-btn:hover, .btn:hover { background: #00faff; box-shadow: 0 0 12px #0ff; }
    .input-field { padding: 10px; width: 100%; font-family: monospace; border: 1px solid #0ff6; border-radius: 6px; background: #000; color: #0ff; }
  </style>
</head>
<body>
  <div class="license-box">
    <h1>Activate License</h1>
    <p class="license-desc">Please send <strong>200 USDT (TRC20)</strong> to the wallet address below and enter your transaction hash.</p>
    <div class="wallet-address" id="targetWallet">TWWKr8K7pZuXTHK6ogVwZ7kAN5mVLHMmpp</div>
    <button class="copy-btn" onclick="copyWallet()">Copy Wallet Address</button>
    <p>Enter your transaction hash:</p>
    <input class="input-field" id="txHash" placeholder="Paste transaction hash here..." />
    <button class="btn" onclick="submitHash()">Submit</button>
  </div>

  <script>
    const API_BASE_URL = "https://dolphinwalletfinderbackend-production.up.railway.app";

    function authHeaders() {
      const token = localStorage.getItem("token");
      if (!token) {
        alert("Please log in first.");
        window.location.href = "login.html";
        return null;
      }
      return { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' };
    }

    function copyWallet() {
      navigator.clipboard.writeText(document.getElementById("targetWallet").innerText);
      alert("Wallet address copied!");
    }

    function submitHash() {
      const hash = document.getElementById("txHash").value.trim();
      if (!hash) {
        alert("Please enter transaction hash.");
        return;
      }

      const headers = authHeaders();
      if (!headers) return;

      fetch(API_BASE_URL + "/api/license/request", {
        method: "POST",
        headers,
        body: JSON.stringify({ tx_hash: hash })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("✅ Transaction submitted. Awaiting admin approval.");
          window.location.href = "profile.html";
        } else {
          alert("❌ " + (data.error || "Unknown error"));
        }
      })
      .catch(() => alert("Server error occurred."));
    }
  </script>
</body>
</html>
